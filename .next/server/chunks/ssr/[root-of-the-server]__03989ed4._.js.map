{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase.ts"],"sourcesContent":["\nimport { initializeApp, getApp, getApps, type FirebaseApp } from \"firebase/app\";\nimport { getFirestore, type Firestore } from \"firebase/firestore\";\n\n// Minimal logging\nconsole.log(\"[firebase.ts] Initializing Firebase...\");\n\nconst firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n};\n\nif (!firebaseConfig.projectId || !firebaseConfig.apiKey) {\n  console.error(\"[firebase.ts] FATAL ERROR: Firebase projectId or apiKey is MISSING in environment variables.\");\n}\n\nlet app: FirebaseApp;\nlet db: Firestore;\n\nif (getApps().length === 0) {\n  try {\n    app = initializeApp(firebaseConfig);\n    console.log(\"[firebase.ts] Firebase app initialized. Project ID:\", app.options.projectId);\n  } catch (e: any) {\n    console.error(\"[firebase.ts] FAILED to initialize Firebase app:\", e.message);\n    // @ts-ignore\n    app = null;\n  }\n} else {\n  app = getApp();\n  console.log(\"[firebase.ts] Using existing Firebase app. Project ID:\", app.options.projectId);\n}\n\n// @ts-ignore\nif (app) {\n  try {\n    // @ts-ignore\n    db = getFirestore(app);\n    console.log(\"[firebase.ts] Firestore instance obtained.\");\n  } catch (e: any) {\n    console.error(\"[firebase.ts] FAILED to get Firestore instance:\", e?.message);\n  }\n} else {\n    console.error(\"[firebase.ts] Firebase app not properly initialized, cannot get Firestore.\");\n}\n\nexport { app, db };\n"],"names":[],"mappings":";;;;AACA;AAAA;AACA;AAAA;;;AAEA,kBAAkB;AAClB,QAAQ,GAAG,CAAC;AAEZ,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACP;AAEA,IAAI,CAAC,eAAe,SAAS,IAAI,CAAC,eAAe,MAAM,EAAE;IACvD,QAAQ,KAAK,CAAC;AAChB;AAEA,IAAI;AACJ,IAAI;AAEJ,IAAI,CAAA,GAAA,oLAAA,CAAA,UAAO,AAAD,IAAI,MAAM,KAAK,GAAG;IAC1B,IAAI;QACF,MAAM,CAAA,GAAA,oLAAA,CAAA,gBAAa,AAAD,EAAE;QACpB,QAAQ,GAAG,CAAC,uDAAuD,IAAI,OAAO,CAAC,SAAS;IAC1F,EAAE,OAAO,GAAQ;QACf,QAAQ,KAAK,CAAC,oDAAoD,EAAE,OAAO;QAC3E,aAAa;QACb,MAAM;IACR;AACF,OAAO;IACL,MAAM,CAAA,GAAA,oLAAA,CAAA,SAAM,AAAD;IACX,QAAQ,GAAG,CAAC,0DAA0D,IAAI,OAAO,CAAC,SAAS;AAC7F;AAEA,aAAa;AACb,IAAI,KAAK;IACP,IAAI;QACF,aAAa;QACb,KAAK,CAAA,GAAA,iKAAA,CAAA,eAAY,AAAD,EAAE;QAClB,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,GAAQ;QACf,QAAQ,KAAK,CAAC,mDAAmD,GAAG;IACtE;AACF,OAAO;IACH,QAAQ,KAAK,CAAC;AAClB","debugId":null}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/genkit.ts"],"sourcesContent":["\nimport '@/lib/firebase'; // Ensure Firebase is initialized early\nimport {genkit} from 'genkit';\nimport {googleAI} from '@genkit-ai/googleai'; // Impor plugin Google AI\n\nif (!process.env.GOOGLE_API_KEY) {\n  const errorMessage = \"Kesalahan Konfigurasi: GOOGLE_API_KEY tidak ditemukan di environment variables. Ini dibutuhkan oleh plugin Google AI. Pastikan sudah di-set di file .env Anda.\";\n  console.error(`\\n\\n🛑 ${errorMessage}\\n\\n`);\n  throw new Error(errorMessage);\n}\n\nexport const ai = genkit({\n  plugins: [\n    googleAI(), // Gunakan plugin Google AI\n  ],\n  model: 'googleai/gemini-1.5-flash-latest', // Model diubah ke Gemini 1.5 Flash terbaru\n  // Opsi telemetry tidak lagi dikonfigurasi di sini untuk Genkit v1.x\n  // Jika butuh logging, konfigurasi dilakukan secara berbeda atau via environment.\n});\n\n"],"names":[],"mappings":";;;AACA,8MAAyB,uCAAuC;AAChE;AAAA;AACA,8TAA8C,yBAAyB;AAAvE;;;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IAC/B,MAAM,eAAe;IACrB,QAAQ,KAAK,CAAC,CAAC,OAAO,EAAE,aAAa,IAAI,CAAC;IAC1C,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,KAAK,CAAA,GAAA,uIAAA,CAAA,SAAM,AAAD,EAAE;IACvB,SAAS;QACP,CAAA,GAAA,2KAAA,CAAA,WAAQ,AAAD;KACR;IACD,OAAO;AAGT","debugId":null}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/types/aiSettings.ts"],"sourcesContent":["\nimport { z } from 'zod';\n\nexport const AI_AGENT_BEHAVIORS = [\n  \"Ramah & Membantu\",\n  \"Profesional & To-the-point\",\n  \"Humoris & Santai\",\n  \"Empatik & Sabar\",\n] as const;\nexport type AiAgentBehavior = typeof AI_AGENT_BEHAVIORS[number];\n\nexport const AI_TRANSFER_CONDITIONS = [\n  \"Pelanggan Meminta Secara Eksplisit\",\n  \"AI Tidak Menemukan Jawaban (Setelah 2x Coba)\",\n  \"Terdeteksi Emosi Negatif dari Pelanggan\",\n  \"Disebut Kata Kunci Eskalasi (mis. 'manajer', 'komplain')\",\n  \"Setelah 5 Pertanyaan Tanpa Solusi\",\n] as const;\nexport type AiTransferCondition = typeof AI_TRANSFER_CONDITIONS[number];\n\nconst FollowUpDelaysSchema = z.object({\n  firstAttemptHours: z.preprocess(\n    (val) => (val === \"\" || val === undefined || val === null) ? undefined : parseInt(String(val), 10),\n    z.number({ invalid_type_error: \"Jam harus angka.\"}).min(1, \"Minimal 1 jam.\").max(168, \"Maksimal 168 jam (7 hari).\").optional()\n  ),\n  secondAttemptDays: z.preprocess(\n    (val) => (val === \"\" || val === undefined || val === null) ? undefined : parseInt(String(val), 10),\n    z.number({ invalid_type_error: \"Hari harus angka.\"}).min(1, \"Minimal 1 hari.\").max(30, \"Maksimal 30 hari.\").optional()\n  ),\n  thirdAttemptDays: z.preprocess(\n    (val) => (val === \"\" || val === undefined || val === null) ? undefined : parseInt(String(val), 10),\n    z.number({ invalid_type_error: \"Hari harus angka.\"}).min(1, \"Minimal 1 hari.\").max(30, \"Maksimal 30 hari.\").optional()\n  ),\n  fourthAttemptDays: z.preprocess(\n    (val) => (val === \"\" || val === undefined || val === null) ? undefined : parseInt(String(val), 10),\n    z.number({ invalid_type_error: \"Hari harus angka.\"}).min(1, \"Minimal 1 hari.\").max(90, \"Maksimal 90 hari.\").optional()\n  ),\n});\n\nexport const AiSettingsFormSchema = z.object({\n  agentBehavior: z.enum(AI_AGENT_BEHAVIORS, {\n    required_error: \"Perilaku agen AI harus dipilih.\",\n  }),\n  welcomeMessage: z.string().min(10, \"Pesan selamat datang minimal 10 karakter.\").max(300, \"Pesan selamat datang maksimal 300 karakter.\"),\n  transferConditions: z.array(z.enum(AI_TRANSFER_CONDITIONS)).min(1, \"Minimal satu kondisi transfer harus dipilih.\"),\n  knowledgeBaseDescription: z.string().max(10000, \"Deskripsi sumber pengetahuan maksimal 10000 karakter.\").optional().describe(\"Panduan tingkat tinggi untuk AI. Detail pengetahuan akan diambil melalui tools.\"),\n  \n  enableHumanHandoff: z.boolean().default(false).describe(\"Aktifkan notifikasi ke agen manusia jika AI perlu bantuan.\"),\n  humanAgentWhatsAppNumber: z.string().regex(/^\\+?[0-9\\s-]{10,18}$|^$/, \"Format nomor WhatsApp agen tidak valid (mis. +628123456789 atau kosong).\").optional().describe(\"Nomor WhatsApp agen manusia untuk notifikasi handoff.\"),\n\n  enableFollowUp: z.boolean().default(false).describe(\"Aktifkan fitur follow-up otomatis untuk pelanggan yang pernah menghubungi via WhatsApp namun belum melakukan kunjungan atau transaksi. Follow-up berhenti jika pelanggan tercatat datang/bertransaksi.\"),\n  followUpMessageTemplate: z.string().max(300, \"Template pesan follow-up maksimal 300 karakter.\").optional(),\n  followUpDelays: FollowUpDelaysSchema.optional(),\n  mainPrompt: z.string().min(100, \"Prompt utama minimal 100 karakter.\").max(15000, \"Prompt utama maksimal 15000 karakter.\").optional().describe(\"Prompt utama yang mengarahkan perilaku dan logika Zoya.\"),\n}).superRefine((data, ctx) => {\n  if (data.enableFollowUp) {\n    if (!data.followUpMessageTemplate || data.followUpMessageTemplate.trim() === \"\") {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"Template pesan follow-up diperlukan jika fitur follow-up aktif.\",\n        path: [\"followUpMessageTemplate\"],\n      });\n    }\n    if (!data.followUpDelays?.firstAttemptHours) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"Penundaan follow-up pertama (jam) diperlukan.\",\n        path: [\"followUpDelays\", \"firstAttemptHours\"],\n      });\n    }\n  }\n  if (data.enableHumanHandoff && (!data.humanAgentWhatsAppNumber || data.humanAgentWhatsAppNumber.trim() === \"\")) {\n    ctx.addIssue({\n      code: z.ZodIssueCode.custom,\n      message: \"Nomor WhatsApp Agen Manusia diperlukan jika notifikasi handoff aktif.\",\n      path: [\"humanAgentWhatsAppNumber\"],\n    });\n  }\n});\n\nexport type AiSettingsFormValues = z.infer<typeof AiSettingsFormSchema>;\nexport type FollowUpDelaysValues = z.infer<typeof FollowUpDelaysSchema>;\n\nexport const DEFAULT_MAIN_PROMPT_ZOYA = `\nAnda adalah \"Zoya\" - Customer Service AI dari QLAB Moto Detailing.\n\n🎯 Gaya Bahasa:\n- Santai dan akrab, kayak ngobrol sama temen tongkrongan.\n- Gunakan sapaan seperti \"bro\", \"kak\", atau \"mas\".\n- Tetap informatif, jelas, dan cepat nangkep maksud pelanggan.\n- Gunakan istilah otomotif santai: \"kinclong\", \"ganteng maksimal\", \"spa motor\".\n- Gunakan emoji secukupnya untuk menambah ekspresi: ✅😎✨💸🛠️👋.\n- Hindari kata kasar, tapi boleh pakai \"anjay\" atau \"wih\" untuk ekspresi kaget positif.\n- Selalu jawab dalam Bahasa Indonesia.\n\n🧠 Logika Utama & Pengetahuan Umum (BEKAL ANDA, BUKAN UNTUK DITUNJUKKAN KE USER):\n- Layanan \"Full Detailing\" HANYA TERSEDIA untuk motor dengan cat GLOSSY. Jika user bertanya untuk motor DOFF, tolak dengan sopan dan tawarkan layanan lain (misal: \"Premium Wash\" atau \"Coating Doff\").\n- Harga \"Coating\" untuk motor DOFF dan GLOSSY itu BERBEDA. Jika user bertanya soal coating, tanyakan dulu jenis cat motornya (doff/glossy) dan tipe motornya untuk estimasi.\n- Motor besar (Moge) seperti Harley, atau motor 600cc ke atas biasanya masuk ukuran \"XL\" yang harganya berbeda.\n- QLAB Moto Detailing berlokasi di Jl. Sukasenang V No.1A, Cikutra, Kec. Cibeunying Kidul, Kota Bandung, Jawa Barat 40124. Jam buka: Setiap Hari 09:00 - 21:00 WIB.\n- INFO_UMUM_BENGKEL: QLAB Moto Detailing adalah bengkel perawatan dan detailing motor. <!-- Ini akan diisi info tambahan jika ada -->\n\n🛠️ Tool yang Bisa Kamu Pakai:\n1.  **cariSizeMotorTool**: Untuk mendapatkan ukuran motor (S, M, L, XL).\n    Input: {\"namaMotor\": \"NMAX\"}\n    Output: {\"success\": true, \"size\": \"M\", \"message\": \"Motor Yamaha NMAX (nmax) termasuk ukuran M.\", \"vehicleModelFound\": \"NMAX\"}\n    Gunakan 'message' dari output tool jika sukses untuk menginformasikan user.\n2.  **cariInfoLayananTool**: Untuk mencari daftar layanan berdasarkan kata kunci.\n    Input: {\"keyword\": \"coating\"}\n    Output: Array berisi objek layanan yang cocok (nama, deskripsi, harga dasar, varian, dll.). Bisa array kosong.\n\n📝 FLOW INTERAKSI & PENGGUNAAN TOOL:\n- Sapa user dengan ramah.\n- **Jika user bertanya soal ukuran motor ATAU harga layanan yang butuh ukuran motor**:\n  1. Panggil tool 'cariSizeMotorTool' untuk mendapatkan ukuran motornya.\n  2. Setelah tahu ukurannya dari output tool (misalnya, output tool bilang \"Motor Yamaha NMAX (nmax) termasuk ukuran M.\"), sampaikan ke user ukuran motornya (misalnya, 'Wih, NMAX kamu itu masuk ukuran M bro!').\n  3. Setelah itu, FOKUS untuk bertanya layanan mana yang dia minati tanpa membahas harga dulu. Contoh: 'Nah, untuk NMAX ukuran M ini, kamu minatnya layanan apa nih? Mau dibikin kinclong total dengan Full Detailing, atau mau dilapis coating biar catnya awet, atau cukup Premium Wash aja biar seger lagi?'\n- **Jika user bertanya soal jenis layanan secara umum (misalnya \"coating itu apa?\", \"poles itu apa?\", \"info cuci dong\"), atau menyebutkan kata kunci layanan yang tidak spesifik**:\n  1. Jelaskan dulu secara singkat apa itu jenis layanan tersebut jika user bertanya \"apa itu...\".\n  2. Kemudian, panggil tool 'cariInfoLayananTool' dengan kata kunci yang relevan (misalnya \"coating\", \"cuci\", \"poles\").\n  3. Jika tool mengembalikan satu atau lebih layanan:\n      - Sebutkan nama-nama layanan yang tersedia berdasarkan hasil tool. Misalnya: \"Untuk coating, kita ada beberapa pilihan nih bro: [Nama Layanan Coating 1], [Nama Layanan Coating 2], dll.\" (Gunakan nama layanan dari output tool).\n      - Kamu boleh tambahkan sedikit info unik dari field 'description' masing-masing layanan jika ada dan relevan untuk membantu user memilih.\n  4. Setelah menyebutkan pilihan layanan:\n      - Jika kamu **belum tahu** tipe motor pelanggan (belum pernah disebut atau dicari ukurannya), tanyakan tipe motornya. Contoh: \"Kira-kira motor kamu apa nih bro, biar Zoya bisa bantu pilih yang paling pas?\"\n      - Jika kamu **sudah tahu** tipe motor pelanggan (misalnya dari tool 'cariSizeMotorTool' sebelumnya atau user sudah sebut), langsung tanyakan dari pilihan layanan tadi, mana yang dia minati. Contoh: \"Nah, buat [Tipe Motor Pelanggan] kamu, dari pilihan [jenis layanan, misal coating] tadi, ada yang bikin kamu tertarik bro?\"\n  5. Jika tool 'cariInfoLayananTool' tidak menemukan layanan (hasilnya array kosong), informasikan ke user bahwa layanan dengan kata kunci tersebut belum tersedia atau minta user memperjelas.\n- Jika user sudah menyebutkan NAMA LAYANAN SPESIFIK dan TIPE MOTORNYA, dan bertanya harga:\n    - Gunakan tool 'cariSizeMotorTool' untuk mendapatkan ukuran motor jika belum tahu.\n    - Gunakan tool 'cariInfoLayananTool' dengan nama layanan spesifik tersebut untuk mendapatkan detailnya (harga dasar, varian harga, dll).\n    - Dari output 'cariInfoLayananTool', cari harga yang sesuai dengan ukuran motor. Jika ada varian, periksa harga varian. Jika tidak ada varian atau harga spesifik untuk ukuran, gunakan harga dasar.\n    - Sampaikan estimasi harga dan durasi jika ada.\n- Setelah memberikan informasi, selalu tawarkan bantuan lebih lanjut atau ajak booking.\n- Jika user bertanya di luar topik detailing motor QLAB, jawab dengan sopan bahwa Anda hanya bisa membantu soal QLAB Moto Detailing.\n\nJAWABAN ZOYA (format natural, TANPA menyebutkan \"Pengetahuan Umum\" atau \"Logika Utama\" Anda):\n`.trim();\n\n\nexport const DEFAULT_AI_SETTINGS: AiSettingsFormValues = {\n  agentBehavior: \"Humoris & Santai\",\n  welcomeMessage: \"Halo bro! Zoya di sini, siap bantu seputar QLAB Moto Detailing. Ada yang bisa Zoya bantu?\",\n  transferConditions: [\"Pelanggan Meminta Secara Eksplisit\"],\n  knowledgeBaseDescription: `Anda adalah asisten AI untuk QLAB Moto Detailing. Tugas utama Anda adalah membantu pelanggan dan staf. Gunakan pengetahuan umum tentang layanan dan produk QLAB. Jika perlu informasi spesifik seperti ukuran motor atau detail layanan, gunakan tool yang tersedia.`,\n  mainPrompt: DEFAULT_MAIN_PROMPT_ZOYA,\n  enableHumanHandoff: false,\n  humanAgentWhatsAppNumber: '',\n  enableFollowUp: false,\n  followUpMessageTemplate: \"Halo Kak, kami perhatikan Anda sempat menghubungi kami beberapa waktu lalu. Apakah ada rencana untuk berkunjung ke bengkel kami? Ada promo menarik lho!\",\n  followUpDelays: {\n    firstAttemptHours: 24,\n    secondAttemptDays: 7,\n    thirdAttemptDays: 7,\n    fourthAttemptDays: 30,\n  },\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 453, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/types/aiToolSchemas.ts"],"sourcesContent":["\nimport { z } from 'zod';\n\n// Skema untuk varian produk/layanan yang akan dikembalikan oleh tool\nconst ProductVariantInfoSchema = z.object({\n  name: z.string().describe(\"Nama varian.\"),\n  price: z.number().describe(\"Harga varian.\"),\n  pointsAwarded: z.number().optional().describe(\"Poin yang diberikan untuk varian ini.\"),\n  estimatedDuration: z.string().optional().describe(\"Estimasi durasi pengerjaan varian ini (jika layanan).\"),\n});\nexport type ProductVariantInfo = z.infer<typeof ProductVariantInfoSchema>;\n\n// Skema untuk informasi produk/layanan yang akan dikembalikan oleh tool\nexport const ProductServiceInfoSchema = z.object({\n  id: z.string().describe(\"ID unik produk/layanan.\"),\n  name: z.string().describe(\"Nama produk atau layanan.\"),\n  type: z.enum(['Layanan', 'Produk']).describe(\"Jenis item, apakah 'Layanan' atau 'Produk'.\"),\n  category: z.string().describe(\"Kategori produk/layanan.\"),\n  price: z.number().describe(\"Harga dasar produk/layanan. Bisa 0 jika harga ditentukan oleh varian.\"),\n  description: z.string().optional().describe(\"Deskripsi singkat produk/layanan.\"),\n  pointsAwarded: z.number().optional().describe(\"Poin loyalitas yang diberikan untuk produk/layanan dasar ini.\"),\n  estimatedDuration: z.string().optional().describe(\"Estimasi durasi pengerjaan (jika ini adalah layanan).\"),\n  variants: z.array(ProductVariantInfoSchema).optional().describe(\"Daftar varian yang tersedia untuk produk/layanan ini.\"),\n});\nexport type ProductServiceInfo = z.infer<typeof ProductServiceInfoSchema>;\n\n// Skema untuk informasi motor klien\nconst ClientMotorcycleInfoSchema = z.object({\n  name: z.string().describe(\"Nama atau model motor.\"),\n  licensePlate: z.string().describe(\"Plat nomor motor.\"),\n});\nexport type ClientMotorcycleInfo = z.infer<typeof ClientMotorcycleInfoSchema>;\n\n// Skema untuk informasi klien yang akan dikembalikan oleh tool\nexport const ClientInfoSchema = z.object({\n  id: z.string().describe(\"ID unik klien.\"),\n  name: z.string().describe(\"Nama lengkap klien.\"),\n  phone: z.string().describe(\"Nomor telepon klien.\"),\n  loyaltyPoints: z.number().describe(\"Jumlah poin loyalitas yang dimiliki klien.\"),\n  motorcycles: z.array(ClientMotorcycleInfoSchema).optional().describe(\"Daftar sepeda motor yang terdaftar atas nama klien ini.\"),\n  lastVisit: z.string().optional().describe(\"Tanggal kunjungan terakhir klien (format YYYY-MM-DD).\"),\n});\nexport type ClientInfo = z.infer<typeof ClientInfoSchema>;\n"],"names":[],"mappings":";;;;AACA;AAAA;;AAEA,qEAAqE;AACrE,MAAM,2BAA2B,iLAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACxC,MAAM,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,OAAO,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC3B,eAAe,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC9C,mBAAmB,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;AACpD;AAIO,MAAM,2BAA2B,iLAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC/C,IAAI,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACxB,MAAM,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,MAAM,iLAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAW;KAAS,EAAE,QAAQ,CAAC;IAC7C,UAAU,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC9B,OAAO,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC3B,aAAa,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC5C,eAAe,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAC9C,mBAAmB,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;IAClD,UAAU,iLAAA,CAAA,IAAC,CAAC,KAAK,CAAC,0BAA0B,QAAQ,GAAG,QAAQ,CAAC;AAClE;AAGA,oCAAoC;AACpC,MAAM,6BAA6B,iLAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC1C,MAAM,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,cAAc,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;AACpC;AAIO,MAAM,mBAAmB,iLAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACvC,IAAI,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACxB,MAAM,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC1B,OAAO,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC3B,eAAe,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,CAAC;IACnC,aAAa,iLAAA,CAAA,IAAC,CAAC,KAAK,CAAC,4BAA4B,QAAQ,GAAG,QAAQ,CAAC;IACrE,WAAW,iLAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;AAC5C","debugId":null}},
    {"offset": {"line": 500, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/ai/flows/cs-whatsapp-reply-flow.ts"],"sourcesContent":["\n'use server';\n/**\n * @fileOverview Flow AI untuk WhatsApp Customer Service QLAB.\n * Versi ini fokus pada pemanggilan model dengan tool 'cariSizeMotor' dan 'cariInfoLayanan'.\n */\nimport { ai } from '@/ai/genkit';\nimport * as z from 'zod';\nimport { db } from '@/lib/firebase';\nimport { collection, query as firestoreQuery, where, getDocs as getFirestoreDocs, Timestamp, doc, getDoc as getFirestoreDoc, limit } from 'firebase/firestore';\nimport { DEFAULT_AI_SETTINGS } from '@/types/aiSettings';\nimport type { ProductServiceInfo } from '@/types/aiToolSchemas'; // Import tipe\nimport { ProductServiceInfoSchema } from '@/types/aiToolSchemas'; // Import skema jika diperlukan untuk output tool\n\n// == Definisi Tool cariSizeMotorTool ==\nconst CariSizeMotorInputSchema = z.object({\n  namaMotor: z.string().min(1, \"Nama motor tidak boleh kosong.\").describe('Nama atau model motor yang ingin dicari ukurannya, contoh: NMAX, PCX, Vario.'),\n});\ntype CariSizeMotorInput = z.infer<typeof CariSizeMotorInputSchema>;\n\nconst CariSizeMotorOutputSchema = z.object({\n  success: z.boolean().describe('Apakah pencarian berhasil atau tidak.'),\n  size: z.string().optional().describe('Ukuran motor (S, M, L, XL) jika ditemukan.'),\n  message: z.string().describe('Pesan hasil pencarian, termasuk ukuran jika berhasil atau pesan error jika gagal.'),\n  vehicleModelFound: z.string().optional().describe('Nama model motor yang sebenarnya ditemukan di database.'),\n});\ntype CariSizeMotorOutput = z.infer<typeof CariSizeMotorOutputSchema>;\n\nasync function findMotorSize(input: CariSizeMotorInput): Promise<CariSizeMotorOutput> {\n    const { namaMotor } = input;\n    const namaMotorLower = namaMotor.toLowerCase().trim();\n    console.log(`[cariSizeMotorTool.fn] Mencari ukuran untuk: \"${namaMotorLower}\"`);\n\n    if (!db) {\n      console.error(\"[cariSizeMotorTool.fn] Firestore DB (db) is not initialized.\");\n      return { success: false, message: \"Database tidak terhubung, tidak bisa mencari ukuran motor.\" };\n    }\n\n    try {\n      const vehicleTypesRef = collection(db, 'vehicleTypes');\n      let q;\n      let querySnapshot;\n      let foundVehicleData: any = null;\n\n      // 1. Try searching by alias (case-insensitive as aliases should be stored in lowercase)\n      q = firestoreQuery(vehicleTypesRef, where('aliases', 'array-contains', namaMotorLower), limit(1));\n      querySnapshot = await getFirestoreDocs(q);\n\n      if (!querySnapshot.empty) {\n        foundVehicleData = querySnapshot.docs[0].data();\n      } else {\n        // 2. If not found by alias, try searching by model_lowercase (exact match)\n        console.log(`[cariSizeMotorTool.fn] Tidak ditemukan via alias, mencoba model_lowercase: \"${namaMotorLower}\"`);\n        q = firestoreQuery(vehicleTypesRef, where('model_lowercase', '==', namaMotorLower), limit(1));\n        querySnapshot = await getFirestoreDocs(q);\n        if (!querySnapshot.empty) {\n          foundVehicleData = querySnapshot.docs[0].data();\n        } else {\n          // 3. Fallback: search by model name (case-insensitive by client-side filtering)\n          console.log(`[cariSizeMotorTool.fn] Tidak ditemukan via model_lowercase, mencoba model (client-side filter): \"${namaMotorLower}\"`);\n          const allVehiclesSnapshot = await getFirestoreDocs(vehicleTypesRef); // Get all\n          for (const doc of allVehiclesSnapshot.docs) {\n            const vehicle = doc.data();\n            if (vehicle.model && vehicle.model.toLowerCase() === namaMotorLower) {\n              foundVehicleData = vehicle;\n              break;\n            }\n          }\n        }\n      }\n\n      if (foundVehicleData && foundVehicleData.size) {\n        console.log(`[cariSizeMotorTool.fn] Ditemukan: Model \"${foundVehicleData.model}\", Size \"${foundVehicleData.size}\"`);\n        return {\n          success: true,\n          size: foundVehicleData.size,\n          message: `Motor ${foundVehicleData.model} (${namaMotor}) termasuk ukuran ${foundVehicleData.size}.`,\n          vehicleModelFound: foundVehicleData.model,\n        };\n      } else {\n        console.log(`[cariSizeMotorTool.fn] Ukuran motor untuk \"${namaMotor}\" tidak ditemukan.`);\n        return {\n          success: false,\n          message: `Maaf, Zoya tidak menemukan ukuran untuk motor \"${namaMotor}\". Mungkin bisa coba nama model yang lebih spesifik atau umum?`,\n        };\n      }\n    } catch (error) {\n      console.error(\"[cariSizeMotorTool.fn] Error saat mencari ukuran motor:\", error);\n      return {\n        success: false,\n        message: \"Terjadi kesalahan internal saat mencari ukuran motor. Coba lagi nanti.\",\n      };\n    }\n}\n\nconst cariSizeMotorTool = ai.defineTool(\n  {\n    name: 'cariSizeMotor',\n    description: 'Mencari ukuran (S, M, L, XL) untuk model motor tertentu. Gunakan tool ini jika perlu mengetahui ukuran motor untuk menentukan harga layanan atau informasi lain, atau jika user menanyakan ukuran motornya.',\n    inputSchema: CariSizeMotorInputSchema,\n    outputSchema: CariSizeMotorOutputSchema,\n  },\n  findMotorSize\n);\n// == Akhir definisi Tool cariSizeMotorTool ==\n\n\n// == Definisi Tool cariInfoLayananTool ==\nconst CariInfoLayananInputSchema = z.object({\n  keyword: z.string().min(1, \"Kata kunci pencarian tidak boleh kosong.\").describe('Kata kunci untuk mencari layanan, mis. \"cuci\", \"coating\", \"detailing\".'),\n});\ntype CariInfoLayananInput = z.infer<typeof CariInfoLayananInputSchema>;\n\nconst CariInfoLayananOutputSchema = z.array(ProductServiceInfoSchema).describe(\"Daftar layanan yang cocok dengan kata kunci, bisa kosong.\");\ntype CariInfoLayananOutput = z.infer<typeof CariInfoLayananOutputSchema>;\n\nasync function findLayananByKeyword(input: CariInfoLayananInput): Promise<CariInfoLayananOutput> {\n  const { keyword } = input;\n  const keywordLower = keyword.toLowerCase().trim();\n  console.log(`[cariInfoLayananTool.fn] Mencari layanan dengan keyword: \"${keywordLower}\"`);\n\n  if (!db) {\n    console.error(\"[cariInfoLayananTool.fn] Firestore DB (db) is not initialized.\");\n    return []; \n  }\n\n  const matchingServices: ProductServiceInfo[] = [];\n\n  try {\n    const servicesCollectionRef = collection(db, 'services');\n    const q = firestoreQuery(servicesCollectionRef); // Ambil semua layanan\n    const querySnapshot = await getFirestoreDocs(q);\n\n    querySnapshot.forEach((docSnap) => {\n      const serviceData = docSnap.data();\n      const serviceNameLower = serviceData.name?.toLowerCase();\n      const serviceCategoryLower = serviceData.category?.toLowerCase();\n      const serviceDescriptionLower = serviceData.description?.toLowerCase();\n\n\n      if ( (serviceNameLower && serviceNameLower.includes(keywordLower)) ||\n           (serviceCategoryLower && serviceCategoryLower.includes(keywordLower)) ||\n           (serviceDescriptionLower && serviceDescriptionLower.includes(keywordLower))\n         ) {\n        const serviceItem: ProductServiceInfo = {\n          id: docSnap.id,\n          name: serviceData.name,\n          type: serviceData.type as 'Layanan' | 'Produk',\n          category: serviceData.category,\n          price: serviceData.price,\n          description: serviceData.description || undefined,\n          pointsAwarded: serviceData.pointsAwarded || undefined,\n          estimatedDuration: serviceData.estimatedDuration || undefined,\n          variants: serviceData.variants?.map((v: any) => ({\n            id: v.id || undefined,\n            name: v.name,\n            price: v.price,\n            pointsAwarded: v.pointsAwarded,\n            estimatedDuration: v.estimatedDuration,\n            stockQuantity: v.stockQuantity,\n            costPrice: v.costPrice,\n          })) || undefined,\n          stockQuantity: serviceData.stockQuantity,\n          costPrice: serviceData.costPrice,\n        };\n        \n        const validationResult = ProductServiceInfoSchema.safeParse(serviceItem);\n        if (validationResult.success) {\n          matchingServices.push(validationResult.data);\n        } else {\n          console.warn(`[cariInfoLayananTool.fn] Data layanan ${docSnap.id} tidak valid:`, validationResult.error.format());\n        }\n      }\n    });\n\n    console.log(`[cariInfoLayananTool.fn] Ditemukan ${matchingServices.length} layanan yang cocok dengan keyword \"${keywordLower}\".`);\n    return matchingServices;\n\n  } catch (error) {\n    console.error(\"[cariInfoLayananTool.fn] Error saat mencari layanan:\", error);\n    return [];\n  }\n}\n\nconst cariInfoLayananTool = ai.defineTool(\n  {\n    name: 'cariInfoLayanan',\n    description: 'Mencari daftar layanan atau produk yang tersedia berdasarkan kata kunci. Berguna jika pelanggan bertanya layanan apa saja yang ada atau menyebutkan jenis layanan secara umum.',\n    inputSchema: CariInfoLayananInputSchema,\n    outputSchema: CariInfoLayananOutputSchema,\n  },\n  findLayananByKeyword\n);\n// == Akhir definisi Tool cariInfoLayananTool ==\n\n\n// Skema internal untuk validasi input chat history di flow\nconst ChatMessageSchemaInternal = z.object({\n  role: z.enum(['user', 'model']),\n  content: z.string(),\n});\nexport type ChatMessage = z.infer<typeof ChatMessageSchemaInternal>;\n\n// Skema input untuk ZoyaChatFlow (TIDAK DI-EXPORT)\nconst ZoyaChatInputSchema = z.object({\n  messages: z.array(ChatMessageSchemaInternal).optional().describe(\"Riwayat percakapan lengkap, jika ada.\"),\n  customerMessage: z.string().min(1, \"Pesan pelanggan tidak boleh kosong.\").describe(\"Pesan terbaru dari customer.\"),\n  senderNumber: z.string().optional().describe(\"Nomor WhatsApp pengirim (opsional).\"),\n  mainPromptString: z.string().optional().describe(\"String prompt utama yang mungkin dikirim dari UI atau diambil dari Firestore.\"),\n  currentDate: z.string().optional(),\n  currentTime: z.string().optional(),\n  tomorrowDate: z.string().optional(),\n  dayAfterTomorrowDate: z.string().optional(),\n});\nexport type ZoyaChatInput = z.infer<typeof ZoyaChatInputSchema>;\n\nconst ZoyaChatOutputSchema = z.object({ // Schema output untuk wrapper function\n  suggestedReply: z.string().describe('Saran balasan yang dihasilkan AI untuk dikirim ke pelanggan.'),\n});\nexport type WhatsAppReplyOutput = z.infer<typeof ZoyaChatOutputSchema>;\n\n\nconst zoyaChatFlow = ai.defineFlow(\n  {\n    name: 'zoyaChatFlow',\n    inputSchema: ZoyaChatInputSchema,\n    outputSchema: z.string(), // Output flow adalah string balasan AI\n  },\n  async (input: ZoyaChatInput): Promise<string> => {\n    console.log(\"[CS-FLOW] zoyaChatFlow input. Customer Message:\", input.customerMessage, \"History Length:\", (input.messages || []).length);\n\n    const lastUserMessageContent = input.customerMessage ||\n                                   (input.messages && input.messages.length > 0 ? input.messages[input.messages.length - 1].content : '');\n\n    if (!lastUserMessageContent || lastUserMessageContent.trim() === '') {\n      console.warn(\"[CS-FLOW] No valid last user message content. Returning empty reply.\");\n      return \"Maaf, Zoya tidak menerima pesan yang jelas.\";\n    }\n\n    let dynamicContext = `INFO_UMUM_BENGKEL: QLAB Moto Detailing adalah bengkel perawatan dan detailing motor.`;\n    if (!db) {\n        console.warn(\"[CS-FLOW] Firestore DB (db) is not initialized. Some context might be missing.\");\n        dynamicContext += \" WARNING: Database tidak terhubung, info detail mungkin tidak akurat.\";\n    }\n    console.log(`[CS-FLOW] Dynamic context built: ${dynamicContext}`);\n\n    const historyForAI = (input.messages || [])\n      .filter(msg => msg.content && msg.content.trim() !== '')\n      .map((msg) => ({\n        role: msg.role,\n        content: [{ text: msg.content }],\n    }));\n\n    const mainPromptFromSettings = input.mainPromptString || DEFAULT_AI_SETTINGS.mainPrompt;\n\n    const finalSystemPrompt = mainPromptFromSettings\n                                .replace(\"{{{dynamicContext}}}\", dynamicContext)\n                                .replace(\"{{{customerMessage}}}\", input.customerMessage) // customerMessage sudah ada di pesan terakhir, tapi ini bisa jadi placeholder tambahan\n                                .replace(/{{#if messages.length}}[\\s\\S]*?{{\\/if}}/g, \"\") \n                                .replace(/{{#if senderNumber}}[\\s\\S]*?{{\\/if}}/g, \"\")\n                                .replace(/{{#if currentDate}}[\\s\\S]*?{{\\/if}}/g, \"\")\n                                .replace(/{{#if tomorrowDate}}[\\s\\S]*?{{\\/if}}/g, \"\");\n\n\n    const messagesForAI = [\n      ...historyForAI,\n      { role: 'user' as const, content: [{ text: input.customerMessage }] }\n    ];\n\n    console.log(`[CS-FLOW] Calling ai.generate with model googleai/gemini-1.5-flash-latest. History Length: ${historyForAI.length}`);\n    console.log(`[CS-FLOW] System Prompt being used (simplified): ${finalSystemPrompt.substring(0, 300)}...`);\n\n    try {\n      const result = await ai.generate({\n        model: 'googleai/gemini-1.5-flash-latest',\n        prompt: finalSystemPrompt, \n        messages: messagesForAI,\n        tools: [cariSizeMotorTool, cariInfoLayananTool], \n        config: { temperature: 0.5 },\n      });\n\n      console.log(\"[CS-FLOW] Raw AI generate result:\", JSON.stringify(result, null, 2));\n      \n      let suggestedReply = \"\";\n      const toolRequestData = result.toolRequest; \n\n      if (toolRequestData) {\n        console.log(\"[CS-FLOW] AI requested a tool call:\", JSON.stringify(toolRequestData, null, 2));\n        let toolOutput: any = null;\n\n        if (toolRequestData.name === 'cariSizeMotor' && toolRequestData.input) {\n          toolOutput = await findMotorSize(toolRequestData.input as CariSizeMotorInput);\n        } else if (toolRequestData.name === 'cariInfoLayanan' && toolRequestData.input) {\n          toolOutput = await findLayananByKeyword(toolRequestData.input as CariInfoLayananInput);\n        } else {\n           suggestedReply = \"Tool tidak dikenal atau input salah.\";\n        }\n\n        if (toolOutput) {\n          console.log(`[CS-FLOW] Tool ${toolRequestData.name} output:`, JSON.stringify(toolOutput, null, 2));\n          const modelResponseAfterTool = await ai.generate({\n            model: 'googleai/gemini-1.5-flash-latest',\n            prompt: finalSystemPrompt,\n            messages: [ \n              ...messagesForAI, \n              result.message,  \n              { \n                role: 'tool',\n                content: [{\n                  toolResponse: {\n                    name: toolRequestData.name,\n                    output: toolOutput, \n                  }\n                }]\n              }\n            ],\n            config: { temperature: 0.5 },\n          });\n          suggestedReply = modelResponseAfterTool.text || \"Zoya bingung setelah pakai alat, coba lagi ya.\";\n        } else if (!suggestedReply) { \n            suggestedReply = \"Maaf, Zoya tidak berhasil memproses permintaan alatnya.\";\n        }\n        console.log(\"[CS-FLOW] Tool output message / AI reply after tool:\", suggestedReply);\n\n      } else {\n        suggestedReply = result.text || \"\"; \n      }\n\n      const finishReason = result.finishReason;\n      const safetyRatings = result.safetyRatings;\n\n      console.log(`[CS-FLOW] AI Finish Reason: ${finishReason}`);\n      if (safetyRatings && safetyRatings.length > 0) {\n        console.log('[CS-FLOW] AI Safety Ratings:', JSON.stringify(safetyRatings, null, 2));\n      }\n\n      if (!suggestedReply && finishReason !== \"stop\") {\n        console.error(`[CS-FLOW] ❌ AI generation failed or tool handling error. Finish Reason: ${finishReason}. Safety: ${JSON.stringify(safetyRatings)}`);\n        return \"Maaf, Zoya lagi agak bingung nih boskuu. Coba tanya lagi dengan cara lain ya, atau hubungi CS langsung.\";\n      }\n      return suggestedReply;\n\n    } catch (flowError: any) {\n        console.error(\"[CS-FLOW] ❌ Critical error dalam flow zoyaChatFlow:\", flowError);\n        if (flowError.cause) {\n            console.error(\"[CS-FLOW] Error Cause:\", JSON.stringify(flowError.cause, null, 2));\n        }\n        return `Waduh, Zoya lagi error nih, boskuu. Coba tanya lagi nanti ya. (Pesan Error: ${flowError.message || 'Kesalahan internal tidak diketahui'})`;\n    }\n  }\n);\n\nexport async function generateWhatsAppReply(input: ZoyaChatInput): Promise<WhatsAppReplyOutput> {\n  console.log(\"[CS-FLOW] generateWhatsAppReply input:\", JSON.stringify(input, null, 2));\n\n  let mainPromptToUse = input.mainPromptString;\n\n  if (!mainPromptToUse) {\n    try {\n      if (db) {\n        const settingsDocRef = doc(db, 'appSettings', 'aiAgentConfig');\n        const docSnap = await getFirestoreDoc(settingsDocRef);\n        if (docSnap.exists() && docSnap.data()?.mainPrompt) {\n          mainPromptToUse = docSnap.data().mainPrompt;\n          console.log(\"[CS-FLOW] generateWhatsAppReply: Using mainPromptString from Firestore.\");\n        } else {\n          console.log(\"[CS-FLOW] generateWhatsAppReply: mainPrompt not found in Firestore or is empty. Checking default.\");\n          if (DEFAULT_AI_SETTINGS && DEFAULT_AI_SETTINGS.mainPrompt) {\n            mainPromptToUse = DEFAULT_AI_SETTINGS.mainPrompt;\n            console.log(\"[CS-FLOW] generateWhatsAppReply: Using DEFAULT_AI_SETTINGS.mainPrompt.\");\n          } else {\n            console.error(\"[CS-FLOW] generateWhatsAppReply: FATAL - DEFAULT_AI_SETTINGS or its mainPrompt is undefined!\");\n            mainPromptToUse = \"Anda adalah asisten AI yang membantu. Jawab pertanyaan pelanggan.\";\n          }\n        }\n      } else { \n        console.log(\"[CS-FLOW] generateWhatsAppReply: Firestore (db) not available. Checking default for mainPrompt.\");\n        if (DEFAULT_AI_SETTINGS && DEFAULT_AI_SETTINGS.mainPrompt) {\n          mainPromptToUse = DEFAULT_AI_SETTINGS.mainPrompt;\n          console.log(\"[CS-FLOW] generateWhatsAppReply: Using DEFAULT_AI_SETTINGS.mainPrompt (db not available).\");\n        } else {\n          console.error(\"[CS-FLOW] generateWhatsAppReply: FATAL - DEFAULT_AI_SETTINGS or its mainPrompt is undefined (db not available)!\");\n          mainPromptToUse = \"Anda adalah asisten AI. Jawab pertanyaan.\";\n        }\n      }\n    } catch (error) {\n      console.error(\"[CS-FLOW] generateWhatsAppReply: Error fetching mainPrompt from Firestore. Using default.\", error);\n      mainPromptToUse = (DEFAULT_AI_SETTINGS && DEFAULT_AI_SETTINGS.mainPrompt) ? DEFAULT_AI_SETTINGS.mainPrompt : \"Asisten AI. Jawab pertanyaan.\";\n    }\n  } else {\n     console.log(\"[CS-FLOW] generateWhatsAppReply: Using mainPromptString directly from input.\");\n  }\n\n  const flowInput: ZoyaChatInput = {\n    messages: input.messages || [],\n    customerMessage: input.customerMessage,\n    senderNumber: input.senderNumber,\n    mainPromptString: mainPromptToUse,\n    currentDate: input.currentDate,\n    currentTime: input.currentTime,\n    tomorrowDate: input.tomorrowDate,\n    dayAfterTomorrowDate: input.dayAfterTomorrowDate,\n  };\n\n  try {\n    const replyText = await zoyaChatFlow(flowInput);\n    return { suggestedReply: replyText };\n  } catch (error: any) {\n    console.error(\"[CS-FLOW Wrapper] Error running zoyaChatFlow:\", error);\n    return { suggestedReply: `Maaf, Zoya sedang ada kendala teknis. (${error.message || 'Tidak diketahui'})` };\n  }\n}\n    "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 884, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/ai-cs-assistant/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {generateWhatsAppReply as '4053660f6447b38038e1d20965a3df3cd57a2a7b51'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 948, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/ai-cs-assistant/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/ai-cs-assistant/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/ai-cs-assistant/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA0S,GACvU,wEACA","debugId":null}},
    {"offset": {"line": 962, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/ai-cs-assistant/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/ai-cs-assistant/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/ai-cs-assistant/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAsR,GACnT,oDACA","debugId":null}},
    {"offset": {"line": 976, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}